---
import type { AstroInstance } from "astro";
import Layout from "@layouts/Layout.astro";

type BlogData = AstroInstance &
  Partial<{
    title: string;
    description: string;
    date: Date;
  }>;

// Find all the blogposts in the /posts/ folder, import them,
// and pull summary info for display
// todo: pagination? that might be hard with it being static
const posts = await Promise.all(
  Object.values(import.meta.glob<BlogData>("./posts/*.astro")).map((f) => f()),
).then((posts) =>
  posts
    .filter((post) => post.date)
    .sort((a, b) => {
      const aTime = a.date?.getTime() ?? 0;
      const bTime = b.date?.getTime() ?? 0;
      return bTime - aTime;
    })
);
---

<Layout title="Blog Index">
  <h1>Recent Posts</h1>
  <hr />
  {
    posts.map((post) => (
      <article>
        <h2>
          <a href={post.url}>{post.title}</a>{" "}
        </h2>
        <p>{post.description}</p>
      </article>
    ))
  }
</Layout>

<style>
  hr {
    margin-bottom: 1em;
    margin-inline: inherit;
  }
  article {
    padding: 0.4em;

    & > h2 {
      margin-block: 0 0.4em;
    }
    & > p {
      padding-left: 2ch;
    }
  }
</style>
